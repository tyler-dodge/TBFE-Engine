TbfeFile={}
function TbfeFile.NextSet(Text,Character)
   local foundChar=string.find(Text,Character)
   Text=string.reverse(Text)
   local StartString=string.reverse(string.sub(Text,-1*(foundChar-1)))
   local EndString=string.sub(string.reverse(Text),foundChar+1)
   return StartString,EndString
end

function TbfeFile.SaveGame(name)
   local file=io.open(name..".dat","rb")
   if file~=nil then
      file=io.open(name..".dat","wb")
   else
      engine:CreateFile(name..".dat")
      file=io.open(name..".dat","wb")
      local SaveLocations=io.open("SaveLocations.cfg","a+")
      SaveLocations:write(name.."\n")
      SaveLocations:close()
   end
   file:write(""..Hunger..",")
   file:write(""..Thirst..",")
   file:write(""..Energy..",")
   file:write(""..engine.Time..",")
   for i=1,3,1 do
      file:write(""..TBFE.TBFE_Base_MainPlayer.inventory:Get(i-1)..",")
   end
   file:write("|")
   for i=1,3,1 do
      file:write(""..TBFE.TBFE_Base_MainPlayer.ToolInventory:Get(i-1)..",")
      file:write(""..TBFE.TBFE_Base_MainPlayer.ToolInventory:GetAmount(i-1)..",")
   end      
   file:write("|")
   file:write('"')
   file:write(FarmSave)
   file:write('"')
   file:close()
end
function TbfeFile.LoadGame(name)
   local file=io.open(name..".dat","rb")
   local fileLine=file:read()
   Hunger,fileLine=TbfeFile.NextSet(fileLine,",")
   Hunger=tonumber(Hunger)
   Thirst,fileLine=TbfeFile.NextSet(fileLine,",")
   Thirst=tonumber(Thirst)
   Energy,fileLine=TbfeFile.NextSet(fileLine,",")
   Energy=tonumber(Energy)
   engine.Time,fileLine=TbfeFile.NextSet(fileLine,",")
   engine.Time=tonumber(engine.Time)
   for i=1,3,1 do
      local item
      item,fileLine=TbfeFile.NextSet(fileLine,",")
      item=tonumber(item)
      TBFE.TBFE_Base_MainPlayer.inventory:Set(i-1,item)
   end
   item,fileLine=TbfeFile.NextSet(fileLine,"|")
   for i=1,3,1 do
      local tool,toolAmount
      tool,fileLine=TbfeFile.NextSet(fileLine,",")
      tool=tonumber(tool)
      toolAmount,fileLine=TbfeFile.NextSet(fileLine,",")
      toolAmount=tonumber(toolAmount)
      local InitialAmount=TBFE.TBFE_Base_MainPlayer.ToolInventory:GetAmount(i-1)
      print(tool..":"..InitialAmount)
      TBFE.TBFE_Base_MainPlayer.ToolInventory:Remove(i-1,InitialAmount)
      print(TBFE.TBFE_Base_MainPlayer.ToolInventory:GetAmount(i-1))
      TBFE.TBFE_Base_MainPlayer.ToolInventory:Set(i-1,tool,toolAmount)
   end
   item,fileLine=TbfeFile.NextSet(fileLine,"|")
   item,fileLine=TbfeFile.NextSet(fileLine,'"')
   FarmSave,fileLine=TbfeFile.NextSet(fileLine,'"')
   FarmSlot=FarmSave
end
function TbfeFile.LoadOptions()
   local OptionsFile=io.open("Options.cfg")
   local Data=OptionsFile:read()
   local loss
   loss,Data=TbfeFile.NextSet(Data,':')
   TBFE.TBFE_Render_SCREEN_WIDTH,Data=TbfeFile.NextSet(Data,',')
   Data=OptionsFile:read()
   loss,Data=TbfeFile.NextSet(Data,':')
   TBFE.TBFE_Render_SCREEN_HEIGHT,Data=TbfeFile.NextSet(Data,',')
   engine.RenderWindow:Init()
end