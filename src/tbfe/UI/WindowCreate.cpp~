#include "WindowCreate.h"

vector<WindowType> WindowTypeList;
vector<Window *> CreatedWindowList;
bool Debug;
bool loadWindows(std::string FileName)
{ 

  ifstream WindowData(FileName.c_str(),ifstream::binary);
  if (WindowData==NULL)
    {      
      cout << FileName << " failed to load\n";
      TBFE_Base::MainConsole.errorMessage(0,FileName); 
      return false;
    };
  bool EndLoop=false;
  int i=0;
  while (i<100)
    {
      i++;
      WindowType NewWindow;
      NewWindow.Name=loadString(&WindowData,':');
      if (NewWindow.Name=="")
	{	   
	  return true;
	}
      string Data;
      Data=loadString(&WindowData,'(');
      if (Data=="")
	{
	  TBFE_Base::MainConsole.errorMessage(1,FileName);
	  if (Debug)
	    {
	      cout << NewWindow.Name << "Failed at (\n";
	    };
	  return false;
	};
      int ElementNumber=atoi(Data.c_str());

      Data=loadString(&WindowData,',');
      if (Data=="")
	{
	  TBFE_Base::MainConsole.errorMessage(1,FileName); 
	  if (Debug)
	    {
	      cout << NewWindow.Name << "Failed at Width\n";
	    };
	  return false;
	};
      NewWindow.Width=atoi(Data.c_str());
      
      Data=loadString(&WindowData,')');
      if (Data=="")
	{
	  TBFE_Base::MainConsole.errorMessage(1,FileName); 
	  if (Debug)
	    {
	      cout << NewWindow.Name << "Failed at Height\n";
	    };
	  return false;
	};
      NewWindow.Height=atoi(Data.c_str());

      NewWindow.Elements.resize(ElementNumber); 
      for (int i=0;i<ElementNumber;i++)
	{
	  string ElementData;
	  loadString(&WindowData,';');
	  std::string ElementName;
	  std::string ElementSpecial;
	  Position ElementPosition;
	  
	  ElementData=loadString(&WindowData,':');
	  if (ElementData=="")
	    {
	      TBFE_Base::MainConsole.errorMessage(1,FileName+".Name");
	      if (Debug)
		{
		  cout << NewWindow.Name << "Failed at Element " << i << ":Name"<< "\n";
		};
	      return false;
	    };
	  NewWindow.Elements[i].Name=ElementData;
	  
	  ElementData=loadString(&WindowData,'(');
	  if (ElementData=="")
	    {
	      TBFE_Base::MainConsole.errorMessage(1,FileName+".Name"); 	   
	      if (Debug)
		{
		  cout << NewWindow.Name << "Failed at Element " << i << ":Name"<< "\n";
		};
	      return false;
	    };
	  NewWindow.Elements[i].Type=ElementData;

	  ElementData=loadString(&WindowData,',');
	  if (ElementData=="")
	    {
	      TBFE_Base::MainConsole.errorMessage(1,FileName+".Type"); 	      
	      if (Debug)
		{
		  cout << NewWindow.Name << "Failed at Element " << i << ":Type" << "\n";
		};
	      return false;
	    };
	  if (ElementData.c_str()=="SCREEN")
	    {
	      NewWindow.Elements[i].ElementPosition.X=-1;
	    }
	  else
	    {
	      NewWindow.Elements[i].ElementPosition.X=atoi(ElementData.c_str());
	    }
	  ElementData=loadString(&WindowData,')');
	  if (ElementData=="")
	    {
	      TBFE_Base::MainConsole.errorMessage(1,FileName+".ElementPosition.X"); 	      
	      if (Debug)
		{
		  cout << NewWindow.Name << "Failed at Element " << i << ":ElementPosition.X" << "\n";
		};
	      return false;
	    };
	  NewWindow.Elements[i].ElementPosition.Y=atoi(ElementData.c_str());
	  
	  if (ElementData.c_str()=="SCREEN")
	    {
	      NewWindow.Elements[i].ElementPosition.Y=-1;
	    }
	  else
	   { 
	      NewWindow.Elements[i].ElementPosition.Y=atoi(ElementData.c_str());
	    }
	  ElementData=loadString(&WindowData,',');
	  NewWindow.Elements[i].Special=ElementData;
	}; 
      loadString(&WindowData,'\n');
      addWindowType(NewWindow);
    };
};
void AddWindowType(WindowType NewType)
{
  WindowTypeList.push_back(NewType);
};
int GetWindowType(std::string WindowName)
{
  for (int i=0;i<WindowTypeList.size();i++)
    {
      if (WindowTypeList.at(i).Name==WindowName)
	{
	  return i;
	};
    };
  return -1;
};
Window * CreateWindow(int X,int Y, std::string WindowTypeName)
{
  std::stringstream ConsoleWrite;
  Window * TempWindow;
  SDL_Color ColorKey;
  ColorKey.r=0;
  ColorKey.g=255;
  ColorKey.b=0;
  int WindowTypeNum;
  WindowTypeNum=GetWindowType(WindowTypeName);
  if (WindowTypeNum==-1)
    {
      return NULL;
    };
  TempWindow=new Window(WindowTypeList.at(WindowTypeNum).Width,WindowTypeList.at(WindowTypeNum).Height,X,Y);
  for (int i=0;i<WindowTypeList[WindowTypeNum].Elements.size();i++)
    {
      Element * NewElement;
      std::string Type=WindowTypeList[WindowTypeNum].Elements[i].Type;
      if (Type=="StatBar")
	{
	  NewElement=new StatBar(WindowTypeList[WindowTypeNum].Elements[i].ElementPosition.X,
				 WindowTypeList[WindowTypeNum].Elements[i].ElementPosition.Y,
				 WindowTypeList[WindowTypeNum].Elements[i].Special);
	};
      if (Type=="Label")
	{
	  NewElement=new Label(WindowTypeList[WindowTypeNum].Elements[i].ElementPosition.X,
			       WindowTypeList[WindowTypeNum].Elements[i].ElementPosition.Y,
			       WindowTypeList[WindowTypeNum].Elements[i].Special);
	};
      if (Type=="ImageBox")
	{
	  NewElement=new ImageBox(WindowTypeList[WindowTypeNum].Elements[i].ElementPosition.X,
				  WindowTypeList[WindowTypeNum].Elements[i].ElementPosition.Y,
				  WindowTypeList[WindowTypeNum].Elements[i].Special);
	};
      if (NewElement!=NULL)
	{
	  NewElement->setName(WindowTypeList[WindowTypeNum].Elements[i].Name);
	  TempWindow->addElement(NewElement);
	};
    };
  CreatedWindowList.push_back(TempWindow);
  return TempWindow;
};
void DeleteWindowList()
{
  for (int i=0;i<CreatedWindowList.size();i++)
    {
      delete CreatedWindowList.at(i);
    };
  CreatedWindowList.resize(0);
};
