#include "ImageBox.h"
ImageBox::ImageBox(int x,int y,string Source):Element(x,y)
{
  Special=Source;
  string ImageSource=Source;
  if (ImageSource.find('(')<ImageSource.size())
    {
      ImageSource=ImageSource.substr(0,ImageSource.find('('));
    }
  Image=LoadImage(ImageSource.c_str());
  if (Image!=NULL)
    {
      Dimensions.X=Image->w;
      Dimensions.Y=Image->h;
    }
  else
    {
      Dimensions.X=0;
      Dimensions.Y=0;
    };
};
ImageBox::~ImageBox()
{
  SDL_FreeSurface(Image);
};
void ImageBox::Reload()
{
  string ImageSource=Special;
  if (ImageSource.find('(')<ImageSource.size())
    {
      ImageSource=ImageSource.substr(0,ImageSource.find('('));
    }
  SDL_FreeSurface(Image);
  Image=LoadImage(ImageSource.c_str());
};
void ImageBox::RenderElement(SDL_Surface * screen, Position ScreenPosition)
{
  string Box;
  SDL_Rect Clip;
  if (Special.find('(')<Special.length())
    {
      string Data;
      int StringPos;
      Box=Special.substr(Special.find('(')+1);
      
      StringPos=(int)Box.find(';');
      Data=Box.substr(0,StringPos);
      Clip.x=atoi(Data.c_str());
      
      StringPos=Box.find(';')+1;
      Box=Box.substr(StringPos);
      
      StringPos=Box.find(';');
      Data=Box.substr(0,StringPos);
      Clip.y=atoi(Data.c_str());

      StringPos=Box.find(';')+1;
      Box=Box.substr(StringPos);
      
      StringPos=Box.find(';');
      Data=Box.substr(0,StringPos).c_str();
      Clip.w=atoi(Data.c_str());

      StringPos=Box.find(';')+1;
      Box=Box.substr(StringPos);

      StringPos=Box.find(')');
      Data=Box.substr(0,StringPos);
      Clip.h=atoi(Data.c_str());
    }
  else
    {
      Clip.x=0;
      Clip.y=0;
      if (Image!=NULL)
	{
	  Clip.w=Image->w;
	  Clip.h=Image->h;
	}
      else
	{
	  Clip.w=0;
	  Clip.h=0;
	};
    };
  Dimensions.X=Clip.w;
  Dimensions.Y=Clip.h;
  ApplyImage(ScreenPosition.X+CurrentPosition.X,ScreenPosition.Y+CurrentPosition.Y,Image,screen,&Clip);
};
